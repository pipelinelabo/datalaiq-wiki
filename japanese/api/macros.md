# マクロAPI

 ウェブAPIは、検索マクロへのアクセスおよび作成方法を提供します。検索マクロは、検索の解析段階で展開される、短い文字列と長い文字列とのマッピングです。

## 検索マクロの構造

WebサーバはマクロをJSON構造体で返しますが、これはフィールドを更新するためにも使用されます。マクロを更新するために構造体を送信する場合、すべてのフィールドが更新されるわけではないことに注意してください（たとえば、LastUpdated フィールドを手動で変更することはできません）:

* ID: マクロに付与される一意なID
* UID: マクロ所有者のUID
* GIDs: マクロにアクセスできるグループのID
* Name: マクロ名
* Expansion: マクロを展開する際の文字列
* LastUpdated: マクロが最後に更新された日付
* Synced: (内部的に使用される)

## マクロをリスト表示する

現在のユーザーに属するすべてのマクロのリストを取得するには、 `/api/macros` で GET してください。結果はこのようになります:

```
[{"ID":1,"UID":1,"GIDs":null,"Name":"FOO","Expansion":"grep foo","LastUpdated":"2018-10-31T20:56:24.629561628Z","Synced":true}]
```

この例では、UID 1のユーザーが "FOO "という1つのマクロを持っており、"grep foo "という文字列に展開されます。マクロのIDは1であり、他のAPIで使用することができます。

### ユーザーIDを指定してマクロを取得する

管理者ユーザーは `/api/users/{uid}/macros` に対して、`{uid}` を任意のユーザーIDに置き換えてGETすることで、特定のユーザーのマクロの一覧を取得することができます。管理者以外のユーザは、このAPIを使用して自分のマクロを取得することができます。

### グループIDを指定してマクロを取得する

管理者ユーザーまたはグループのメンバーは、 `/api/groups/{gid}/macros` に対して GET を実行することで、指定したグループがアクセスできるマクロの一覧を取得することができます。

### 全てのマクロを取得する

管理者ユーザーは `/api/macros/all` で GET を実行することで、システム上のすべてのマクロのリストを取得することができます。

## 特定のマクロを取得する

特定のマクロの構造体は、 `/api/macros/{id}` を GET して、 `{id}` をマクロ ID に置き換えて取得することができます。例えば、`/api/macros/1` を GET すると、以下のような結果が返されます:

```
{"ID":1,"UID":1,"GIDs":null,"Name":"FOO","Expansion":"grep foo","LastUpdated":"2018-10-31T20:56:24.629561628Z","Synced":true}
```

## マクロを新規作成する

新しいマクロは `/api/macros` への POST で作成することができます。リクエストのボディには、以下のように Name と Expansion フィールド、および (オプションで) GIDs フィールドを含める必要があります:

```
{"GIDs": [1, 2], "Name": "TEST", "Expansion": "grep test | count"}
```

この例では、新しいIDは2なので、`/api/macros/2`をGETすると新しいマクロの完全な構造体が返されます:

```
{"ID":2,"UID":1,"GIDs":null,"Name":"TEST","Expansion":"grep test | count","LastUpdated":"2018-10-31T21:05:34.231426316Z","Synced":true}
```

## マクロを更新する

マクロの更新は `/api/macros/{id}` へのPUTで、作成と同じ構造体フォーマットを使用します。安全のために、変更がなくても毎回GIDs、Name、Expansionフィールドにデータを入力するのがよいことに注意してください。

更新に成功すると、HTTP 200 と更新されたマクロがボディに返されます。

## マクロを削除する

マクロの削除は `/api/macros/{id}` に対する DELETE で実行されます。これは成功するとHTTP 200を返します。