# ウェブサーバーAPIを使用してエントリーをIngestする

ウェブサーバーは、エントリーを直接取り込むためのAPIを提供します。これは、自動化されたスクリプトを実行するときや、ユーザーがファイルをインポートできるようにするときに便利です。

## JSONフォーマットのエントリーをIngestする

自動化されたスクリプトは、独自のエントリを構築し、構造体のJSON配列として送信します。これには、Dataフィールドに任意のバイトを指定できるという利点があります。各エントリーの必須フィールドは以下のとおりです:

* TS: タイムスタンプ(e.g. "2018-02-12T11:06:44.215431364-07:00")
* Tag: 使用されるタグ(e.g. "syslog")
* Data: base64エンコードされた文字列(e.g. "Zm9vCg==")

したがって、"foo" と "test" を含む2つのエントリーを `mytag` タグに格納するには、 `/api/ingest/json` に次のデータで PUT してください:

```
[ { "TS": "2018-02-12T11:06:44.215431364-07:00", "Tag": "mytag", "Data": "Zm9v" }, { "TS": "2018-02-12T11:06:45.215431364-07:00", "Tag": "mytag", "Data": "dGVzdA==" } ]
```

サーバーはingestされたエントリーの数を返します。

## 改行データファイルをingestする

ユーザが提供するデータを取り込むには、改行単位ファイルAPIが最もシンプルなオプションです。これは `/api/ingest/lines` に対して、以下のフォームパーツを含むマルチパートの POST を実行することで構成されます:

* ユーザが提供したファイルを含む `file` という名前のファイル部分
* 希望するインジェストタグを含む `tag` という名前のフィールド
* オプションのフィールド `source`; これを設定すると、エントリーのソース値がオーバーライドされます。 このフィールドは適切に形成されたIPv4またはIPv6アドレスである必要があります。
* オプションのフィールド `noparsetimestamp`; これを "true" に設定すると、各エントリからタイムスタンプをパースしようとするのではなく、現在のタイムスタンプでエントリをインジェストするように強制する。
* オプションのフィールド `assumelocaltimezone`; これを "true" に設定すると、タイムゾーンが明示的に指定されていない場合に、エントリから抽出されたタイムスタンプが (UTC ではなく) ローカルタイムゾーンであるとみなされるようになります。

アップロードされたファイルは、改行で分割されます。各行は個別の項目として取り込まれます。
 
